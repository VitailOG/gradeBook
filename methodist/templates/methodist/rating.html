{% extends 'methodist/base.html' %}
{% load maintag %}
{% load static %}

{% block content %}
    {{ rating.name_subject }}<br>
    <div class="container table-responsive">
        <table class="table table-striped">
            <thead>
            <tr>
                <th>id</th>
                <th>username</th>
                <th>group</th>
                <th>5*</th>
                <th>12*</th>
                <th>дата</th>
                <th>перез</th>
                <th>зар</th>
                <th>викл</th>
                <th>дія</th>
            </tr>
            </thead>
            <tbody>
            {% for i in rating.educational_program.student_set.all %}
                <tr id="user_row_{{ i.user.id }}">
                    <td>{{ i.user.id }}</td>
                    <td>{{ i.user.username }}</td>
                    <td>{{ i.group.name }}</td>
                {% get_current_semester request.path as current_semester %}
                    {% tag i.user.username rating.name_subject current_semester as exists_rating %}
                    {% if exists_rating %}
                        <td><input type="number" value="{{ exists_rating.rating_5 }}" name="rating_5" min="1"
                                   id="id_rating_5"></td>
                        <td><input type="number" value="{{ exists_rating.rating_12 }}" name="rating_12" min="1"
                                   id="id_rating_12"></td>
                        <td><input type="date" name="date_rating" required=""
                                   value="{{ exists_rating.date_rating|date:'Y-m-d' }}" id="id_date_rating"></td>
                        <td><input type="checkbox" {% if exists_rating.retransmission %}checked{% endif %}
                                   name="retransmission" id="id_retransmission"></td>
                        <td><input type="checkbox" {% if exists_rating.credited %}checked{% endif %}
                                   name="credited" id="id_credited"></td>

                        <td>
                            <select name="teacher" id="id_teacher">
                                <option value="">-------</option>
                                {% for i in rating.teachers.all %}
                                    {% if i.id == exists_rating.teacher %}
                                        <option value="{{ i.id }}" selected>{{ i.username }}</option>
                                    {% else %}
                                        <option value="{{ i.id }}">{{ i.username }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </td>

                    {% else %}
                        <form action="{% url 'create' pk_subject=rating.id pk_user=i.user.id semester=current_semester %}" method="post">
                        {% csrf_token %}
                        <td><input type="number" name="rating_5" min="0" required="" id="id_rating_5"></td>
                        <td><input type="number" name="rating_12" min="0" id="id_rating_12"></td>
                        <td><input type="date" name="date_rating" required="" id="id_date_rating"></td>
                        <td><input type="checkbox" name="retransmission" id="id_retransmission"></td>
                        <td><input type="checkbox" name="credited" id="id_credited"></td>

                        <td>
                            <select name="teacher" id="id_teacher">
                                <option value="">-------</option>
                                {% for i in rating.teachers.all %}
                                    <option value="{{ i.id }}">{{ i.username }}</option>
                                {% endfor %}
                            </select>
                        </td>
                    {% endif %}
                    <td id="action_{{ i.user.id }}">
                        {% if exists_rating %}
                            <a id="but_{{ i.id }}" class="btn btn-warning"
                               onclick="updateRating({{ exists_rating.id }}, {{ exists_rating.user }})">Оновити</a>
                        {% else %}
                            <a id="but_{{ i.id }}" class="btn btn-success"
                               onclick="createRating({{ i.user.id }}, {{ rating.id }}, {{ current_semester }})">Створити</a>
{#                            <input type="submit" id="but_{{ i.id }}" onclick="createRating({{ i.user.id }}, {{ ocinku.id }})" value="Створити">#}
                        {% endif %}
                    </td>

                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}

{% block js %}
    <script src="{% static 'methodist/js/rating.js' %}">
    </script>
{% endblock %}